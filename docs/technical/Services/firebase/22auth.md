# Authentication

The application employs two authentication systems to manage user access and functionality securely.

## 1. Web Content Authentication System

The Web Content Authentication System is closely integrated with an AWS database, detailed comprehensively in the support documentation. This system serves as the initial authentication check within the application. If a user is not registered in this system, access to the Firebase Authentication system will not proceed.

### Integration Details
- **Linked with Firebase:** Firebase Authentication is closely integrated with the Web Content Authentication System.
- **Registration Process:** Registration is handled through a WebView, seamlessly integrating application-related information from AWS services.

For more information regarding application-specific details, refer to the AWS service page.

## 2. Firebase Authentication System

The Firebase Authentication System is essential for features such as Daily Login Rewards and In-App Chat Services. This section provides technical insights into the Firebase Authentication implementation.

### Functionality

- **Purpose:** Facilitates secure user authentication necessary for accessing Daily Login Rewards and enabling In-App Chat functionalities.
- **Integration:** Seamlessly integrates with other Firebase services to ensure a robust and secure user experience.

This documentation focuses on the technical aspects of the Firebase Authentication System and its role within the application architecture.

## Overview 

The authentication service of the iOS application utilizes Firebase Authentication, a robust platform provided by Google Firebase. Firebase Authentication offers secure and easy-to-use authentication methods, supporting authentication using passwords, phone numbers, popular identity providers like Google, Facebook, and more.

This document provides a comprehensive guide on integration and how to utilizing Firebase Authentication within iOS application.

Currently Only email and password sign-in method enabled. Provided email&password should already registered web content otherwise user cannot registered in Firestore. User UID generated by firebase this uid also used in Cloud Firestore Database. 

## Firebase Setup

1. **Create Firebase Project:**
      - Go to the Firebase Console (https://console.firebase.google.com/) and create a new project.
      - Follow the setup instructions to add your iOS app to the Firebase project.

2. **Add Firebase SDK:**
      - In your Xcode project, integrate Firebase SDK using Cocoapods or manually by downloading the Firebase SDK from the Firebase Console.

3. **Configure Firebase Authentication:**
      - Enable Authentication service in Firebase Console under the "Authentication" section.
      - Configure sign-in methods (e.g., Email/Password, Google Sign-In) as per your application's requirements.

4. **Setup Firebase.plist:**
      - Download `GoogleService-Info.plist` from Firebase Console and add it to your Xcode project.
      - Ensure the plist is correctly configured with your Firebase project details.


## AuthenticationManager Class

The `FirebaseUserInfoViewModel` class is designed to manage user data and authentication using Firebase services within an iOS application. It utilizes various Firebase modules such as Authentication, Firestore, and Storage to handle user authentication, data storage, and retrieval.

This documentation provides an overview of the class structure, its methods, and how to integrate and use it in your iOS application.

### Dependencies

To use `FirebaseUserInfoViewModel`, ensure the following Firebase modules are integrated into your project using CocoaPods or manually:
- FirebaseAuth
- FirebaseFirestore
- FirebaseDatabase
- FirebaseStorage
- FirebaseMessaging

### Class Structure

Ensure you have the Firebase configuration set up correctly in your project. Instantiate the `FirebaseUserInfoViewModel` class where needed in your SwiftUI views or controllers.

```swift
let firebaseViewModel = FirebaseUserInfoViewModel()
```

### Authentication Functions

#### Creating a New User

```swift
firebaseViewModel.firebaseCreateUser_Login(email: "user@example.com", password: "password123", userID: "uniqueUserID")
```

This function creates a new Firebase user with the provided email, password, and user ID. It also saves default user information to Firestore upon successful creation.

#### Signing In

```swift
firebaseViewModel.firebaseSignIn(email: "user@example.com", password: "password123")
```

Signs in an existing user with the provided email and password. Updates daily login, current level data, and resets consecutive login counts upon successful sign-in.

#### Deleting Account

```swift
await firebaseViewModel.deleteFirebaseAccount()
```

Deletes the current user's Firebase account and associated Firestore document asynchronously. Handles errors if user is not logged in or deletion fails.

#### Saving User Information

```swift
firebaseViewModel.saveUserInformation(userID: "uniqueUserID", shopPoint: 0, totalExp: 0, consecutiveLogin: 0, totalLogin: 1, level: 1, ownedItems: [], expBoosterEndDay: Date.now, lastLogin: Date.now, dailyReward: true, missionRewards: [true,true,true,true,true,true,true], blockedUsers: [], invisibleMsgs: [], fcmToken: "")
```

Saves user information to Firestore. This function should typically be called after creating a new user or upon initial login to set default values.

#### Security Considerations

- Ensure Firebase Security Rules are correctly configured to restrict access to user data based on user roles and authentication status.
- Avoid storing sensitive information such as passwords or API keys directly in Firestore or in user documents.
- **Firebase Security Rules:** Configure Firebase Security Rules to define who has read and write access to your data.
- **Sensitive Data:** Avoid storing sensitive information in Firebase Authentication custom claims or user profiles.


#### Conclusion

The `FirebaseUserInfoViewModel` provides a structured approach to handle user authentication and data management using Firebase services in SwiftUI-based iOS applications. By following the provided guidelines, you can integrate and utilize Firebase effectively to manage user authentication and data securely.

For more detailed information on Firebase services and integration, refer to the [Firebase Documentation](https://firebase.google.com/docs/ios/setup).


Implementing Firebase Authentication in your iOS application provides a secure and reliable way to authenticate users using various methods. Ensure to follow best practices and Firebase guidelines to enhance security and user experience.

For more details on Firebase Authentication, refer to the [Firebase Authentication Documentation](https://firebase.google.com/docs/auth/ios/start).

This technical documentation outlines the functionalities and integration of the `FirebaseUserInfoViewModel` class for managing user authentication and data in an iOS application using Firebase services.
